(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-connect-callback"],{"227c":function(e,n,t){"use strict";var o=t("f5bd").default;t("e838");var i=o(t("0ed1")),a=o(t("ac89"));function c(e){uni.showToast({title:"登录中...",icon:"loading",duration:5e4}),e.terminal=function(){return"H5"}();var n=uni.getStorageSync("visitor")||{};n.userid&&"password"!=e.logintype&&"verifycode"!=e.logintype?u(e):i.default.request("auth/login",e,(function(n){if(0==n.code&&n.data){var t=n.data;if(e.requiresSeller&&!t.user_info.store_id)return uni.showModal({title:"提示",content:"对不起，您还不是卖家",showCancel:!1}),!1;uni.setStorageSync("access_token",t.token),uni.setStorageSync("visitor",t.user_info),uni.hideToast(),uni.showToast({title:"登录成功",duration:1e3,complete:function(){var e=uni.getStorageSync("redirect");setTimeout((function(){a.default.redirect(e)}),1e3),uni.removeStorageSync("redirect")}})}else n.message&&uni.showToast({title:n.message,icon:"none",duration:5e3})}))}function u(e){i.default.request("user/bind",e,(function(e){if(0==e.code){var n=uni.getStorageSync("visitor")||{};uni.setStorageSync("visitor",Object.assign(n,{openid:e.data.weixin})),uni.showToast({title:"绑定成功",duration:1e3,complete:function(){var e=uni.getStorageSync("redirect");setTimeout((function(){a.default.redirect(a.default.isEmpty(e)?"/pages/user/index":e)}),1e3),uni.removeStorageSync("redirect")}})}else e.message&&uni.showToast({title:e.message,icon:"none",duration:1e3,complete:function(){setTimeout((function(){a.default.redirect("/pages/user/index")}),1e3)}})}))}e.exports={site:
/**
 * @link https://www.shopwind.net/
 * @copyright Copyright (c) 2018 ShopWind Inc. All Rights Reserved.
 *
 * This is not free software. Do not use it for commercial purposes. 
 * If you need commercial operation, please contact us to purchase a license.
 * @license https://www.shopwind.net/license/
 *
 * @Id login.js 2019.10.9 $
 * @author winder
 */
function(e){i.default.request("site/read",null,(function(e){e.code}))},login:c,bind:u,mblogin:function(e,n){1==e.accord?("password"==e.logintype?(n.phone_mob=e.phone_mob,n.password=e.password):"verifycode"==e.logintype&&(n.phone_mob=e.phone_mob,n.verifycode=e.verifycode,n.verifycodekey=uni.getStorageSync("smsverifycodekey")),c(n)):uni.showModal({title:"提示",content:"请勾选并同意《用户协议》和《隐私政策》",showCancel:!1})},unilogin:function(e,n){if(1==e.accord){var t=Math.floor(parseFloat(uni.getSystemInfoSync().system));"apple"==n.logintype&&t<13?uni.showModal({title:"提示",content:"iOS13及以上系统版本才支持苹果登录",showCancel:!1}):uni.login({provider:n.logintype,success:function(){uni.getUserInfo({provider:n.logintype,lang:"zh_CN",success:function(e){var t=e.userInfo;Object.assign(n,{unionid:t.unionId?t.unionId:t.openId?t.openId:"",openid:t.openId?t.openId:"",portrait:t.avatarUrl,nickname:t.fullName?t.fullName.familyName+t.fullName.givenName:t.nickName}),c(n)},fail:function(e){uni.showModal({title:"提示",content:e.errMsg,showCancel:!1})}})},fail:function(e){uni.showModal({title:"提示",content:e.errMsg,showCancel:!1})}})}else uni.showModal({title:"提示",content:"请勾选并同意《用户协议》和《隐私政策》",showCancel:!1})},weblogin:function(e,n){1==e.accord?i.default.request("auth/connect",Object.assign(n,{callback:a.default.siteUrl()+"/pages/connect/callback"}),(function(e){0==e.code&&e.data&&(location.href=e.data.redirect)})):uni.showModal({title:"提示",content:"请勾选并同意《用户协议》和《隐私政策》",showCancel:!1})},sendcode:function(e,n,t){i.default.request("sms/send",{phone_mob:e,purpose:"verifycode"},(function(e){0==e.code?(uni.setStorageSync("smsverifycodekey",e.data.codekey),uni.showToast({title:e.message,success:function(){a.default.countDown(n,t)}})):uni.showToast({title:e.message,icon:"none"})}),!1)}}},"2425f":function(e,n,t){"use strict";t("6a54");var o=t("f5bd").default;Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=o(t("ac89")),a=o(t("227c")),c={data:function(){return{form:{logintype:""}}},onLoad:function(e){this.form.logintype=e.state||"","alipay"==this.form.logintype&&(this.form.code=e.auth_code),this.form.logintype?(Object.assign(this.form,e),a.default.login(this.form)):uni.showToast({title:"登录异常，请重新发起",icon:"none",duration:3e3,complete:function(){setTimeout((function(){i.default.pageBack()}),3e3)}})}};n.default=c},"24f0":function(e,n,t){"use strict";t.r(n);var o=t("3441"),i=t("c731");for(var a in i)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return i[e]}))}(a);var c=t("828b"),u=Object(c["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);n["default"]=u.exports},3441:function(e,n,t){"use strict";t.d(n,"b",(function(){return o})),t.d(n,"c",(function(){return i})),t.d(n,"a",(function(){}));var o=function(){var e=this.$createElement,n=this._self._c||e;return n("v-uni-view")},i=[]},c731:function(e,n,t){"use strict";t.r(n);var o=t("2425f"),i=t.n(o);for(var a in o)["default"].indexOf(a)<0&&function(e){t.d(n,e,(function(){return o[e]}))}(a);n["default"]=i.a}}]);