import{u as A,r as C,y as V,d as T,e as a,o as v,c as x,a as e,g as c,i as t,k as u,F as G,h as J,t as y,l as K,j as g,E as U,v as L,x as P,H as q,M as I}from"./index.193ff21d.js";import{a as Q,q as X,h as Z,t as ee,v as te,c as le}from"./blocks.a7684095.js";import{f as S}from"./moment.ab47a251.js";import{s as se}from"./list.1db9be99.js";import{m as oe}from"./seller.b9776ff6.js";import{_ as ie}from"./user.4d579c29.js";import{m as ae}from"./seller.c6d1e739.js";import"./multiselector.e3a63f5d.js";import"./weixin.864acb91.js";import"./chat.b31cc7ff.js";const j=h=>(L("data-v-0cc527e7"),h=h(),P(),h),de={class:"main w pt10"},ne={class:"round-edge pd10 bgf"},ce={class:"pd10"},re=g("\u8425\u9500"),ue=g("\u9650\u65F6\u79D2\u6740"),me={class:"round-edge pd10 bgf mt20"},_e=j(()=>c("h3",{class:"pd10 mb20"},"\u79D2\u6740\u8BBE\u7F6E",-1)),pe={key:0},fe={key:1},be={class:"uni-flex uni-row"},ge=["src"],he={class:"l-h20 width-surplus ml10"},ve={class:"tips pl10 pr10 pt5 pb5 f-12 f-c60 flex-middle",style:{width:"100%"}},ye=g(" \u51CF\u4EF7\u548C\u6298\u6263\u4F18\u60E0\u53EA\u9700\u8BBE\u7F6E\u4E00\u79CD\uFF0C\u4F18\u5148\u6298\u6263\u4F18\u60E0 "),we=j(()=>c("text",{class:"ml20 mr20"},"\u63D0\u4EA4",-1)),Ye={setup(h){const M=A(),w=C(!1),m=V({visible:!1,selected:[]}),n=V({title:"\u5356\u5BB6\u4FC3\u9500",start_time:S().format("YYYY-MM-DD HH:mm:ss"),end_time:S().add(7,"days").format("YYYY-MM-DD HH:mm:ss")}),_=V({list:[]}),r=C({});T(()=>{M.params.id>0&&X({id:M.params.id,queryrules:!0},i=>{i&&(Object.assign(n,i),m.selected=[parseInt(n.goods_id)],k())})});const B=()=>{if(_.list.length<1)return U.warning("\u8BF7\u9009\u62E9\u5546\u54C1");let i={};for(let o in _.list){let l=_.list[o];if(i[l.spec_id]={},l.discount&&Number(l.discount)>0&&Number(l.discount)<10)i[l.spec_id].discount=Number(l.discount);else if(l.decrease&&Number(l.decrease)>0&&Number(l.decrease)<Number(l.price))i[l.spec_id].price=Number(l.decrease);else return U.warning("\u4F18\u60E0\u8BBE\u7F6E\u4E0D\u5408\u7406\uFF0C\u8BF7\u68C0\u67E5\uFF01")}n.id>0?ee(Object.assign(n,{rules:i,goods_id:r.value.goods_id}),o=>{q({title:"\u63D0\u793A",message:"\u79D2\u6740\u8BBE\u7F6E\u6210\u529F\uFF01",type:"success",position:"bottom-left",duration:2e3,onClose:function(){I.replace("/seller/limitbuy/list")}})},w):te(Object.assign(n,{rules:i,goods_id:r.value.goods_id}),o=>{q({title:"\u63D0\u793A",message:"\u79D2\u6740\u5546\u54C1\u6DFB\u52A0\u6210\u529F\uFF01",type:"success",position:"bottom-left",duration:2e3,onClose:function(){I.replace("/seller/limitbuy/list")}})},w)},E=i=>{m.visible=!1,m.selected=i||[],m.selected.length>0&&k()};function k(){Z({goods_id:m.selected[m.selected.length-1]},i=>{r.value=i,le({goods_id:i.goods_id},o=>{for(let l in o.list){let d=o.list[l];_.list[l]={specification:d.spec_1+" "+d.spec_2,price:d.price,stock:d.stock,image:d.image,spec_id:d.spec_id};let p=n.rules;p&&p[d.spec_id]&&(p[d.spec_id].pro_type=="discount"?_.list[l].discount=p[d.spec_id].price:_.list[l].decrease=p[d.spec_id].price)}})})}return(i,o)=>{const l=a("el-col"),d=a("el-breadcrumb-item"),p=a("el-breadcrumb"),F=a("el-input"),f=a("el-form-item"),D=a("el-date-picker"),H=a("el-button"),O=a("WarningFilled"),R=a("el-icon"),b=a("el-table-column"),N=a("el-input-number"),W=a("el-table"),$=a("el-form"),z=a("el-row");return v(),x(G,null,[e(oe),c("div",de,[e(z,{gutter:12},{default:t(()=>[e(l,{span:4},{default:t(()=>[e(ae)]),_:1}),e(l,{span:20},{default:t(()=>[c("div",ne,[c("div",ce,[e(p,{separator:"/"},{default:t(()=>[e(d,null,{default:t(()=>[re]),_:1}),e(d,null,{default:t(()=>[ue]),_:1})]),_:1})])]),c("div",me,[_e,e($,{inline:!0,class:"pd10"},{default:t(()=>[e(f,{label:"\u79D2\u6740\u6807\u9898","label-width":100},{default:t(()=>[e(F,{modelValue:u(n).title,"onUpdate:modelValue":o[0]||(o[0]=s=>u(n).title=s),clearable:""},null,8,["modelValue"])]),_:1}),e(f,{label:"\u5F00\u59CB\u65F6\u95F4","label-width":100},{default:t(()=>[e(D,{modelValue:u(n).start_time,"onUpdate:modelValue":o[1]||(o[1]=s=>u(n).start_time=s),type:"datetime",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(f,{label:"\u7ED3\u675F\u65F6\u95F4","label-width":100},{default:t(()=>[e(D,{modelValue:u(n).end_time,"onUpdate:modelValue":o[2]||(o[2]=s=>u(n).end_time=s),type:"datetime",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),e(f,{label:"\u9009\u62E9\u5546\u54C1","label-width":100},{default:t(()=>[e(H,{onClick:o[3]||(o[3]=s=>u(m).visible=!0),type:"primary",plain:""},{default:t(()=>[r.value.goods_id?(v(),x("text",pe,"\u91CD\u65B0\u9009\u62E9\u5546\u54C1")):(v(),x("text",fe,"\u9009\u62E9\u5546\u54C1"))]),_:1})]),_:1}),r.value.goods_id?(v(),J(f,{key:0,label:" ","label-width":100},{default:t(()=>[c("div",be,[c("p",null,[c("img",{src:r.value.default_image,width:"60",height:"60"},null,8,ge)]),c("p",he,y(r.value.goods_name),1)])]),_:1})):K("",!0),e(f,{label:" ","label-width":100,style:{"margin-right":"0"}},{default:t(()=>[c("p",ve,[e(R,{size:14,class:"mr5"},{default:t(()=>[e(O)]),_:1}),ye]),e(W,{data:u(_).list,border:!0,stripe:!0,"header-cell-style":{background:"#f3f8fe"}},{default:t(()=>[e(b,{label:r.value.spec_qty>0?r.value.spec_name_1+" "+r.value.spec_name_2||"":"\u89C4\u683C"},{default:t(s=>[c("text",null,y(r.value.spec_qty>0?s.row.specification:"\u9ED8\u8BA4\u89C4\u683C"),1)]),_:1},8,["label"]),e(b,{label:"\u5E93\u5B58",width:"70"},{default:t(s=>[g(y(s.row.stock),1)]),_:1}),e(b,{label:"\u539F\u4EF7",width:"100"},{default:t(s=>[g(y(s.row.price),1)]),_:1}),e(b,{label:"\u51CF\u4EF7(\u5143)",width:"170"},{default:t(s=>[e(N,{modelValue:s.row.decrease,"onUpdate:modelValue":Y=>s.row.decrease=Y,"controls-position":"right",step:1,min:0,max:s.row.price},null,8,["modelValue","onUpdate:modelValue","max"])]),_:1}),e(b,{label:"\u6298\u6263(0.01-9.99)",width:"170"},{default:t(s=>[e(N,{modelValue:s.row.discount,"onUpdate:modelValue":Y=>s.row.discount=Y,"controls-position":"right",step:.01,min:.01,max:9.99},null,8,["modelValue","onUpdate:modelValue","step","min","max"])]),_:1})]),_:1},8,["data"])]),_:1}),e(f,{label:" ","label-width":100,class:"mt10"},{default:t(()=>[e(H,{type:"primary",onClick:B,loading:w.value},{default:t(()=>[we]),_:1},8,["loading"])]),_:1})]),_:1})])]),_:1})]),_:1})]),e(se,{title:"\u9009\u62E9\u5546\u54C1",visible:u(m).visible,onClose:E,selected:u(m).selected,limit:1},null,8,["visible","selected"]),e(ie)],64)}}};var Ie=Q(Ye,[["__scopeId","data-v-0cc527e7"]]);export{Ie as default};
